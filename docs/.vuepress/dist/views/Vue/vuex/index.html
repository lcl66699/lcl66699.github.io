<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.35">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/favicon.ico"><title>vuex状态管理 | 我的前端学习记录</title><meta name="description" content="听橘子海，炫沙糖桔">
    <link rel="modulepreload" href="/assets/app.02f2aee7.js"><link rel="modulepreload" href="/assets/index.html.70906024.js"><link rel="modulepreload" href="/assets/index.html.65f2f98d.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper.21dcd24c.js">
    <link rel="stylesheet" href="/assets/style.b29aeafa.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><img class="logo" src="/orange.png" alt="我的前端学习记录"><span class="site-name can-hide">我的前端学习记录</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/views/js/" class="" aria-label="js"><!--[--><!--]--> js <!--[--><!--]--></a></div><div class="navbar-item"><a href="/views/Http/" class="" aria-label="网络"><!--[--><!--]--> 网络 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/views/engineering/" class="" aria-label="工程化"><!--[--><!--]--> 工程化 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Vue"><span class="title">Vue</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Vue"><span class="title">Vue</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/views/Vue/vue2-easy/" class="" aria-label="vue2基础"><!--[--><!--]--> vue2基础 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/views/Vue/vue2-mid/" class="" aria-label="vue2进阶"><!--[--><!--]--> vue2进阶 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/views/Vue/vue-cli/" class="" aria-label="vue-cli"><!--[--><!--]--> vue-cli <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/views/Vue/vue-hard/" class="" aria-label="vue原理篇"><!--[--><!--]--> vue原理篇 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a aria-current="page" href="/views/Vue/vuex/" class="router-link-active router-link-exact-active router-link-active" aria-label="vuex原理"><!--[--><!--]--> vuex原理 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/views/Vue/vue-router/" class="" aria-label="vue-router"><!--[--><!--]--> vue-router <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="React"><span class="title">React</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="React"><span class="title">React</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/views/React/" class="" aria-label="React基础"><!--[--><!--]--> React基础 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><a href="/views/nodejs/" class="" aria-label="nodejs"><!--[--><!--]--> nodejs <!--[--><!--]--></a></div><div class="navbar-item"><a href="/views/Algorithm/" class="" aria-label="算法"><!--[--><!--]--> 算法 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://blog.numb.run" rel="noopener noreferrer" target="_blank" aria-label="个人空间"><!--[--><!--]--> 个人空间 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="其他"><span class="title">其他</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="其他"><span class="title">其他</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/views/other/Git/" class="" aria-label="其他"><!--[--><!--]--> git <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/views/other/performance/" class="" aria-label="其他"><!--[--><!--]--> 性能优化 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/views/other/web-safe/" class="" aria-label="其他"><!--[--><!--]--> web安全 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/views/other/typescript/" class="" aria-label="其他"><!--[--><!--]--> typescript <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/views/other/micro-web/" class="" aria-label="其他"><!--[--><!--]--> 微前端 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/views/other/questions/" class="" aria-label="其他"><!--[--><!--]--> 面试题 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/views/other/questions2/" class="" aria-label="其他"><!--[--><!--]--> 网络面试题 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://blog.csdn.net/qq_38594056?type=blog" rel="noopener noreferrer" target="_blank" aria-label="我的CSDN"><!--[--><!--]--> 我的CSDN <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="切换主题"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" placeholder="搜索" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/views/js/" class="" aria-label="js"><!--[--><!--]--> js <!--[--><!--]--></a></div><div class="navbar-item"><a href="/views/Http/" class="" aria-label="网络"><!--[--><!--]--> 网络 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/views/engineering/" class="" aria-label="工程化"><!--[--><!--]--> 工程化 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Vue"><span class="title">Vue</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Vue"><span class="title">Vue</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/views/Vue/vue2-easy/" class="" aria-label="vue2基础"><!--[--><!--]--> vue2基础 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/views/Vue/vue2-mid/" class="" aria-label="vue2进阶"><!--[--><!--]--> vue2进阶 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/views/Vue/vue-cli/" class="" aria-label="vue-cli"><!--[--><!--]--> vue-cli <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/views/Vue/vue-hard/" class="" aria-label="vue原理篇"><!--[--><!--]--> vue原理篇 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a aria-current="page" href="/views/Vue/vuex/" class="router-link-active router-link-exact-active router-link-active" aria-label="vuex原理"><!--[--><!--]--> vuex原理 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/views/Vue/vue-router/" class="" aria-label="vue-router"><!--[--><!--]--> vue-router <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="React"><span class="title">React</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="React"><span class="title">React</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/views/React/" class="" aria-label="React基础"><!--[--><!--]--> React基础 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><a href="/views/nodejs/" class="" aria-label="nodejs"><!--[--><!--]--> nodejs <!--[--><!--]--></a></div><div class="navbar-item"><a href="/views/Algorithm/" class="" aria-label="算法"><!--[--><!--]--> 算法 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://blog.numb.run" rel="noopener noreferrer" target="_blank" aria-label="个人空间"><!--[--><!--]--> 个人空间 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="其他"><span class="title">其他</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="其他"><span class="title">其他</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/views/other/Git/" class="" aria-label="其他"><!--[--><!--]--> git <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/views/other/performance/" class="" aria-label="其他"><!--[--><!--]--> 性能优化 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/views/other/web-safe/" class="" aria-label="其他"><!--[--><!--]--> web安全 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/views/other/typescript/" class="" aria-label="其他"><!--[--><!--]--> typescript <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/views/other/micro-web/" class="" aria-label="其他"><!--[--><!--]--> 微前端 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/views/other/questions/" class="" aria-label="其他"><!--[--><!--]--> 面试题 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/views/other/questions2/" class="" aria-label="其他"><!--[--><!--]--> 网络面试题 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://blog.csdn.net/qq_38594056?type=blog" rel="noopener noreferrer" target="_blank" aria-label="我的CSDN"><!--[--><!--]--> 我的CSDN <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a aria-current="page" href="/views/Vue/vuex/" class="router-link-active router-link-exact-active router-link-active sidebar-item sidebar-heading active" aria-label="vuex状态管理"><!--[--><!--]--> vuex状态管理 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/views/Vue/vuex/#关于状态管理" class="router-link-active router-link-exact-active sidebar-item" aria-label="关于状态管理"><!--[--><!--]--> 关于状态管理 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/views/Vue/vuex/#vuex介绍" class="router-link-active router-link-exact-active sidebar-item" aria-label="vuex介绍"><!--[--><!--]--> vuex介绍 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/views/Vue/vuex/#更改状态" class="router-link-active router-link-exact-active sidebar-item" aria-label="更改状态"><!--[--><!--]--> 更改状态 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/views/Vue/vuex/#辅助函数" class="router-link-active router-link-exact-active sidebar-item" aria-label="辅助函数"><!--[--><!--]--> 辅助函数 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/views/Vue/vuex/#vuex-3原理" class="router-link-active router-link-exact-active sidebar-item" aria-label="vuex 3原理"><!--[--><!--]--> vuex 3原理 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/views/Vue/vuex/#vuex3源码部分" class="router-link-active router-link-exact-active sidebar-item" aria-label="vuex3源码部分"><!--[--><!--]--> vuex3源码部分 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/views/Vue/vuex/#step1-store-注册" class="router-link-active router-link-exact-active sidebar-item" aria-label="Step1 - store 注册"><!--[--><!--]--> Step1 - store 注册 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/views/Vue/vuex/#step2-响应式" class="router-link-active router-link-exact-active sidebar-item" aria-label="Step2 - 响应式"><!--[--><!--]--> Step2 - 响应式 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/views/Vue/vuex/#step3-衍生数据" class="router-link-active router-link-exact-active sidebar-item" aria-label="Step3 - 衍生数据"><!--[--><!--]--> Step3 - 衍生数据 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/views/Vue/vuex/#step4-actions-mutations" class="router-link-active router-link-exact-active sidebar-item" aria-label="Step4 - Actions/Mutations"><!--[--><!--]--> Step4 - Actions/Mutations <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/views/Vue/vuex/#step5-拆分出多个-module" class="router-link-active router-link-exact-active sidebar-item" aria-label="Step5 - 拆分出多个 Module"><!--[--><!--]--> Step5 - 拆分出多个 Module <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/views/Vue/vuex/#step6-插件机制" class="router-link-active router-link-exact-active sidebar-item" aria-label="Step6 - 插件机制"><!--[--><!--]--> Step6 - 插件机制 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/views/Vue/vuex/#vuex3常见问题" class="router-link-active router-link-exact-active sidebar-item" aria-label="vuex3常见问题"><!--[--><!--]--> vuex3常见问题 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/views/Vue/vuex/#vuex修改数据为何兜一圈" class="router-link-active router-link-exact-active sidebar-item" aria-label="vuex修改数据为何兜一圈？"><!--[--><!--]--> vuex修改数据为何兜一圈？ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/views/Vue/vuex/#vuex什么时候进行的初始化" class="router-link-active router-link-exact-active sidebar-item" aria-label="vuex什么时候进行的初始化？"><!--[--><!--]--> vuex什么时候进行的初始化？ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/views/Vue/vuex/#vuex自己定义了告警-为什么不用console-assert" class="router-link-active router-link-exact-active sidebar-item" aria-label="vuex自己定义了告警，为什么不用console.assert？"><!--[--><!--]--> vuex自己定义了告警，为什么不用console.assert？ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/views/Vue/vuex/#object-create-null-和-区别" class="router-link-active router-link-exact-active sidebar-item" aria-label="object.create(null) 和{}区别"><!--[--><!--]--> object.create(null) 和{}区别 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/views/Vue/vuex/#vuex4" class="router-link-active router-link-exact-active sidebar-item" aria-label="vuex4"><!--[--><!--]--> vuex4 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/views/Vue/vuex/#安装" class="router-link-active router-link-exact-active sidebar-item" aria-label="安装"><!--[--><!--]--> 安装 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/views/Vue/vuex/#用法" class="router-link-active router-link-exact-active sidebar-item" aria-label="用法"><!--[--><!--]--> 用法 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/views/Vue/vuex/#ssr" class="router-link-active router-link-exact-active sidebar-item" aria-label="SSR"><!--[--><!--]--> SSR <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="vuex状态管理" tabindex="-1"><a class="header-anchor" href="#vuex状态管理" aria-hidden="true">#</a> vuex状态管理</h1><p>MVC</p><ul><li>view:html+css</li><li>Controller:js</li><li>Moderl:data</li></ul><p>MVVM</p><ul><li>view</li><li>ViewModel</li><li>Model</li></ul><p>mvvm的理解 比如之前jquery，需要改变一个方块颜色 你需要先获取dom节点，再进行操作颜色</p><ol><li>区别： 就是一个双向绑定 抛弃了对dom的严格感知 无需对流程的过程化操作</li><li>实现： 写法上、代码</li></ol><h4 id="vue组件传值" tabindex="-1"><a class="header-anchor" href="#vue组件传值" aria-hidden="true">#</a> vue组件传值</h4><p>通过父节点 eventBus provide inject提供和注入 vuex</p><h2 id="关于状态管理" tabindex="-1"><a class="header-anchor" href="#关于状态管理" aria-hidden="true">#</a> 关于状态管理</h2><blockquote><p>状态管理是当前前端比较核心的部分，因为视图能用状态描述，所以前端的逻辑复杂度移到了如何让状态“不要出错”，前端与后端的一个区别在于，状态在前端是长生命周期的，又会在这个生命周期中有不可枚举地、未知地、难以追踪的多次修改，保证其按照既定轨迹不出错就很困难了</p></blockquote><blockquote><p>为什么说是某一时刻，状态不是一成不变的，实际业务场景中，状态是一直在被改变的，从而带来视图的随之更新。</p></blockquote><p>往大了看，状态本质是还是一种可以描述视图状态、行为的数据结构，状态的管理则是通过一定的算法将这些数据结构组织、管理起来</p><p>往细了看，状态大致可以分为两类，<strong>本地状态</strong>和<strong>共享状态</strong></p><p>本地状态就是 <code>vue</code> 中的 <code>data</code>，<code>react</code>中的 <code>state</code>，这里我们一般会用来控制弹窗的现实隐藏、<code>loading</code>效果等</p><p>共享状态最常见的场景，业务中肯定会出现大量需要兄弟节点通信、祖孙节点通信等情况的场景，通信的目的是为了状态分享，虽然可以通过一些方式，比如回调函数等手段实现，但都不是最佳实践</p><blockquote><p>一般情况下，小项目不需要什么状态管理工具，简单是避免麻烦的最佳实践，当你的应用膨胀到你已经无法理顺状态流的时候，才是你考虑使用状态管理工具的时机</p><p>项目的复杂度和组件层次结构的复杂性是衡量是否使用状态管理工具的标准，这多多少少取决于经验</p></blockquote><p>所以 <code>Flux</code> 架构及其追随者 <code>Redux</code> <code>Vuex</code>被提出，主要思想是<strong>应用的状态被集中存放到一个仓库中，但是仓库中的状态不能被直接修改</strong>，<strong>必须通过特定的方式</strong>才能更新状态</p><p>理想的状态管理工具需要解决的问题</p><ol><li>状态更新的设计，<code>API</code> 足够少，且简单</li><li>如何共享状态</li><li>状态提升</li><li>状态下降</li><li>同步、异步的处理</li><li>持久状态和临时状态如何区分维护</li><li>状态更新的事务如何管理</li><li>...</li></ol><h2 id="vuex介绍" tabindex="-1"><a class="header-anchor" href="#vuex介绍" aria-hidden="true">#</a> vuex介绍</h2><div class="custom-container tip"><p class="custom-container-title">实践</p><blockquote><p><a href="https://github.com/weipxiu/Vue-vuex" target="_blank" rel="noopener noreferrer">vue-vuex 最佳实践<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://bigdata.bihell.com/language/javascript/vue/vuex.html#%E4%B8%80%E3%80%81vuex%E5%88%B0%E5%BA%95%E6%98%AF%E4%B8%AA%E4%BB%80%E4%B9%88%E9%AC%BC" target="_blank" rel="noopener noreferrer">vuex 最佳实践<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></blockquote></div><h3 id="更改状态" tabindex="-1"><a class="header-anchor" href="#更改状态" aria-hidden="true">#</a> 更改状态</h3><p>「页面 dispatch/commit」-&gt; 「actions/mutations」-&gt; 「状态变更」-&gt; 「页面更新」-&gt; 「页面 dispatch/commit」...</p><ol><li>State</li></ol><p>当前应⽤状态，可以理解为组件的data方法返回的Object</p><ol start="2"><li>Mutations</li></ol><p>更改 Vuex 的 store 中的状态的唯一方法是提交 mutation，必须是同步函数</p><ol start="3"><li>Actions</li></ol><p>Action 可以包含任意异步操作,Action 提交的是 mutation，而不是直接变更状态。</p><ol start="4"><li>Getters</li></ol><p>Getter为state的计算属性</p><ol start="5"><li>Modules</li></ol><p>modules的主要功能是为了防⽌state过于庞⼤和冗余，所以对其进⾏模块化分隔</p><h3 id="辅助函数" tabindex="-1"><a class="header-anchor" href="#辅助函数" aria-hidden="true">#</a> 辅助函数</h3><ol><li>mapStates 使用 mapState 辅助函数帮助我们生成计算属性，入参为对象</li><li>mapGetters</li><li>mapMutaions</li><li>mapActions</li></ol><h2 id="vuex-3原理" tabindex="-1"><a class="header-anchor" href="#vuex-3原理" aria-hidden="true">#</a> vuex 3原理</h2><blockquote><p><a href="https://cn.vuejs.org/v2/guide/plugins.html" target="_blank" rel="noopener noreferrer">开发 vue 插件<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></blockquote><p>首先vuex是vue的一个插件，通过Vue.use()使用</p><p>每个组件（也就是Vue实例）在beforeCreate的生命周期中都通过混入（Vue.mixin） 将 <code>$store</code> 这样的快速访问 <code>store</code> 的快捷属性注入到每一个 <code>vue</code> 实例中 也就是为啥可以通过<code>this.$store.dispatch</code> 等调用方法的原因。 最终每个Vue的实例对象，都有一个$store属性。且是同一个Store实例。</p><p>至于为什么<code>store</code> 是响应式的呢？ 因为利用 <code>vue</code> 的<code>data</code> 里的状态是响应式的啊～</p><p>vuex状态机，是总线机制，单例模式实现的（全局只能有一个实例vuex）</p><p>结构原理 初始化挂载 Store 对象解析</p><blockquote><h3 id="vuex3源码部分" tabindex="-1"><a class="header-anchor" href="#vuex3源码部分" aria-hidden="true">#</a> vuex3源码部分</h3></blockquote><h3 id="step1-store-注册" tabindex="-1"><a class="header-anchor" href="#step1-store-注册" aria-hidden="true">#</a> Step1 - store 注册</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
* store.js - store 注册
*/</span>
<span class="token keyword">let</span> Vue

<span class="token comment">// vue 插件必须要这个 install 函数</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">install</span><span class="token punctuation">(</span><span class="token parameter">_Vue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 拿到 Vue 的构造器，存起来</span>
  Vue <span class="token operator">=</span> _Vue
  <span class="token comment">// 通过 mixin 注入到每一个vue实例 👉 https://cn.vuejs.org/v2/guide/mixins.html</span>
  Vue<span class="token punctuation">.</span><span class="token function">mixin</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">beforeCreate</span><span class="token operator">:</span> vuexInit <span class="token punctuation">}</span><span class="token punctuation">)</span>
  
  <span class="token keyword">function</span> <span class="token function">vuexInit</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$options
    <span class="token comment">// 这样就可以通过 this.$store 访问到 Vuex 实例，拿到 store 了</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>store<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$store <span class="token operator">=</span> <span class="token keyword">typeof</span> options<span class="token punctuation">.</span>store <span class="token operator">===</span> <span class="token string">&#39;function&#39;</span>
        <span class="token operator">?</span> options<span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token operator">:</span> options<span class="token punctuation">.</span>store
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>parent <span class="token operator">&amp;&amp;</span> options<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>$store<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$store <span class="token operator">=</span> options<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>$store
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="step2-响应式" tabindex="-1"><a class="header-anchor" href="#step2-响应式" aria-hidden="true">#</a> Step2 - 响应式</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
* store.js - 实现响应式
*/</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Store</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">resetStoreVM</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> options<span class="token punctuation">.</span>state<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">get</span> <span class="token function">state</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_vm<span class="token punctuation">.</span>_data<span class="token punctuation">.</span>$state
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">resetStoreVM</span><span class="token punctuation">(</span><span class="token parameter">store<span class="token punctuation">,</span> state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 因为 vue 实例的 data 是响应式的，正好利用这一点，就可以实现 state 的响应式</span>
  store<span class="token punctuation">.</span>_vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">$state</span><span class="token operator">:</span> state
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="step3-衍生数据" tabindex="-1"><a class="header-anchor" href="#step3-衍生数据" aria-hidden="true">#</a> Step3 - 衍生数据</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
* store.js - 衍生数据（getters）
*/</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Store</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    
    <span class="token keyword">const</span> state <span class="token operator">=</span> options<span class="token punctuation">.</span>state
    
    <span class="token function">resetStoreVM</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> state<span class="token punctuation">)</span>
    
    <span class="token comment">// 我们用 getters 来收集衍生数据 computed</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>getters <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    
    <span class="token comment">// 简单处理一下，衍生不就是计算一下嘛，传入state</span>
    _<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>getters<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> getterFn</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>getters<span class="token punctuation">,</span> name<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">getterFn</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">get</span> <span class="token function">state</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_vm<span class="token punctuation">.</span>_data<span class="token punctuation">.</span>$state
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">resetStoreVM</span><span class="token punctuation">(</span><span class="token parameter">store<span class="token punctuation">,</span> state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  store<span class="token punctuation">.</span>_vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">$state</span><span class="token operator">:</span> state
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h3 id="step4-actions-mutations" tabindex="-1"><a class="header-anchor" href="#step4-actions-mutations" aria-hidden="true">#</a> Step4 - Actions/Mutations</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
* store.js - Actions/Mutations 行为改变数据
*/</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Store</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    
    <span class="token keyword">const</span> state <span class="token operator">=</span> options<span class="token punctuation">.</span>state
    
    <span class="token function">resetStoreVM</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> state<span class="token punctuation">)</span>
    
    <span class="token keyword">this</span><span class="token punctuation">.</span>getters <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    
    _<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>getters<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> getterFn</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>getters<span class="token punctuation">,</span> name<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">getterFn</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    
    <span class="token comment">// 定义的行为，分别对应异步和同步行为处理</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>actions <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>mutations <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    
    _<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>mutations<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> mutation</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>mutations<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token parameter">payload</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 最终执行的就是 this._vm_data.$state.xxx = xxx 这种操作</span>
        <span class="token function">mutation</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">,</span> payload<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    
    _<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>actions<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>actions<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token parameter">payload</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// action 专注于处理异步，这里传入 this，这样就可以在异步里面通过 commit 触发 mutation 同步数据变化了</span>
        <span class="token function">action</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> payload<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// 触发 mutation 的方式固定是 commit</span>
  <span class="token function">commit</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> payload</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>mutations<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// 触发 action 的方式固定是 dispatch</span>
  <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> payload</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>actions<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">get</span> <span class="token function">state</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_vm<span class="token punctuation">.</span>_data<span class="token punctuation">.</span>$state
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">resetStoreVM</span><span class="token punctuation">(</span><span class="token parameter">store<span class="token punctuation">,</span> state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  store<span class="token punctuation">.</span>_vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">$state</span><span class="token operator">:</span> state
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br></div></div><h3 id="step5-拆分出多个-module" tabindex="-1"><a class="header-anchor" href="#step5-拆分出多个-module" aria-hidden="true">#</a> Step5 - 拆分出多个 Module</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// module 可以对状态模型进行分层，每个 module 又含有自己的 state、getters、actions 等</span>

<span class="token comment">// 定义一个 module 基类</span>
<span class="token keyword">class</span> <span class="token class-name">Module</span> <span class="token punctuation">{</span>
	<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">rawModule</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> rawModule <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_rawModule <span class="token operator">=</span> rawModule
    <span class="token keyword">this</span><span class="token punctuation">.</span>_children <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">getChild</span> <span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_children<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  
   <span class="token function">addChild</span> <span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> module</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_children<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> module
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// module-collection.js 把 module 收集起来</span>
<span class="token keyword">class</span> <span class="token class-name">ModuleCollection</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">register</span><span class="token punctuation">(</span><span class="token parameter">path<span class="token punctuation">,</span> rawModule</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> newModule <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Module</span><span class="token punctuation">(</span>rawModule<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>path<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 如果是根模块 将这个模块挂在到根实例上</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>root <span class="token operator">=</span> newModule
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> parent <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> module<span class="token punctuation">.</span><span class="token function">getChild</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">)</span>
      
      parent<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>path<span class="token punctuation">[</span>path<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> newModule<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 如果有 modules，开始递归注册一波</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>rawModule<span class="token punctuation">.</span>modules<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      _<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>rawModule<span class="token punctuation">.</span>modules<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> rawChildModule</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span> rawChildModule<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// store.js 中</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Store</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 其余代码...</span>
    
    <span class="token comment">// 所有的 modules 注册进来</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_modules <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ModuleCollection</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
    
    <span class="token comment">// 但是这些 modules 中的 actions, mutations, getters 都没有注册，所以我们原来的方法要重新写一下</span>
    <span class="token comment">// 递归的去注册一下就行了，这里抽离一个方法出来实现</span>
    <span class="token function">installModule</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_modules<span class="token punctuation">.</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">installModule</span><span class="token punctuation">(</span><span class="token parameter">store<span class="token punctuation">,</span> state<span class="token punctuation">,</span> path<span class="token punctuation">,</span> root</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// getters</span>
  <span class="token keyword">const</span> getters <span class="token operator">=</span> root<span class="token punctuation">.</span>_rawModule<span class="token punctuation">.</span>getters
  <span class="token keyword">if</span> <span class="token punctuation">(</span>getters<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>getters<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> getterFn</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span>getters<span class="token punctuation">,</span> name<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">getterFn</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span>state<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// mutations</span>
  <span class="token keyword">const</span> mutations <span class="token operator">=</span> root<span class="token punctuation">.</span>_rawModule<span class="token punctuation">.</span>mutations
  <span class="token keyword">if</span> <span class="token punctuation">(</span>mutations<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>mutations<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> mutation</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> _mutations <span class="token operator">=</span> store<span class="token punctuation">.</span>mutations<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">(</span>store<span class="token punctuation">.</span>mutations<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
      _mutations<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token parameter">payload</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">mutation</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span>state<span class="token punctuation">,</span> payload<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      
      store<span class="token punctuation">.</span>mutations<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> _mutations
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// actions</span>
  <span class="token keyword">const</span> actions <span class="token operator">=</span> root<span class="token punctuation">.</span>_rawModule<span class="token punctuation">.</span>actions
  <span class="token keyword">if</span> <span class="token punctuation">(</span>actions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>actions<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> _actions <span class="token operator">=</span> store<span class="token punctuation">.</span>actions<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">(</span>store<span class="token punctuation">.</span>actions<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
      _actions<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token parameter">payload</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">action</span><span class="token punctuation">(</span>store<span class="token punctuation">,</span> payload<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      
      store<span class="token punctuation">.</span>actions<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> _actions
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// 递归</span>
  _<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span>_children<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> childModule</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">installModule</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span> childModule<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br></div></div><h3 id="step6-插件机制" tabindex="-1"><a class="header-anchor" href="#step6-插件机制" aria-hidden="true">#</a> Step6 - 插件机制</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">(</span>options<span class="token punctuation">.</span>plugins <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">plugin</span> <span class="token operator">=&gt;</span> <span class="token function">plugin</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>以上只是以最简化的代码实现了 <code>vuex</code> 核心的 <code>state</code> <code>module</code> <code>actions</code> <code>mutations</code> <code>getters</code> 机制， 如果对源代码感兴趣，可以看<a href="https://juejin.cn/post/6844904001192853511#heading-12" target="_blank" rel="noopener noreferrer">vuex 源码整体架构<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="vuex3常见问题" tabindex="-1"><a class="header-anchor" href="#vuex3常见问题" aria-hidden="true">#</a> vuex3常见问题</h2><h3 id="vuex修改数据为何兜一圈" tabindex="-1"><a class="header-anchor" href="#vuex修改数据为何兜一圈" aria-hidden="true">#</a> vuex修改数据为何兜一圈？</h3><p>异步操作先actions调用muations然后muations去修改</p><h3 id="vuex什么时候进行的初始化" tabindex="-1"><a class="header-anchor" href="#vuex什么时候进行的初始化" aria-hidden="true">#</a> vuex什么时候进行的初始化？</h3><p>beforeCreate</p><h3 id="vuex自己定义了告警-为什么不用console-assert" tabindex="-1"><a class="header-anchor" href="#vuex自己定义了告警-为什么不用console-assert" aria-hidden="true">#</a> vuex自己定义了告警，为什么不用console.assert？</h3><p>console.assert 函数报错不会阻止后续代码执行 因为要throw Error，把进程打断</p><h3 id="object-create-null-和-区别" tabindex="-1"><a class="header-anchor" href="#object-create-null-和-区别" aria-hidden="true">#</a> object.create(null) 和{}区别</h3><ul><li>原型链问题 <ul><li>object.create(null).__proto__为undefined</li><li>{}.__proto指向Object.prototype</li></ul></li></ul><h2 id="vuex4" tabindex="-1"><a class="header-anchor" href="#vuex4" aria-hidden="true">#</a> vuex4</h2><h3 id="安装" tabindex="-1"><a class="header-anchor" href="#安装" aria-hidden="true">#</a> 安装</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">yarn</span> create vite vue3-vuex<span class="token operator"><span class="token file-descriptor important">4</span>&lt;</span>项⽬名，自定义<span class="token operator">&gt;</span> 
<span class="token builtin class-name">cd</span> vue3-vuex4
<span class="token function">yarn</span> // 安装 node_modules
<span class="token function">yarn</span> <span class="token function">add</span> vuex@next // 安装 vuex
<span class="token function">yarn</span> dev // 启动项⽬并访问 localhost:3000
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="用法" tabindex="-1"><a class="header-anchor" href="#用法" aria-hidden="true">#</a> 用法</h3><ul><li>createStore 不传参数 在 vue3 中使⽤ vuex，⼊⼝代码如下（main.js）：</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vuex&#39;</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">&#39;./App.vue&#39;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>store<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>store<span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">&#39;#app&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>app.use 注册插件（vue2 则为 Vue.use）时，会⾃动调⽤参数的 install 方法（例如 vue-router），定位到 node_modules/vuex/dist/vuex.esm-bundler.js ⽂件，找到 install 定义的位置：</p><p>跨组件传递状态的方法中，有 provide/inject 组合因此下⾯的代码可以访问到 store</p><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code> // App.vue ⽂件修改
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"> 
  <span class="token keyword">import</span> <span class="token punctuation">{</span> inject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span>
  <span class="token keyword">import</span> HelloWorld <span class="token keyword">from</span> <span class="token string">&#39;./components/HelloWorld.vue&#39;</span>
  <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">&#39;store&#39;</span><span class="token punctuation">)</span> 
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pre</span><span class="token punctuation">&gt;</span></span>{{ JSON.stringify(store, null, 2) }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pre</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>HelloWorld</span> <span class="token attr-name">msg</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hello vue<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="源码开始" tabindex="-1"><a class="header-anchor" href="#源码开始" aria-hidden="true">#</a> 源码开始</h4><ul><li>将 vuex 的核⼼源码分 3 部分解读，每部分将结合具体的业务代码进⾏展开（源码⽂件 node_modules/vuex/dist/vuex.esm-bundler.js）。</li></ul><ol><li>创建 store，可⻅ ModuleCollection 及末尾的 installModule 和resetStoreState 是需要关注的⽅法。 <ol><li>ModuleCollection 将参数 options 进⾏转换，本质是对 options 对象的包装与扩充，扩充结果作为store._modules 的值</li><li>installModule 的作⽤就是把 state、actions、mutations、getters 分别注册到相应的模块名称下</li><li>resetStoreState 将树状结构的 state，统⼀使⽤ reactive 代理后，挂载 store._state 下，这样未来对 state 的更新，将具有被追踪的能⼒。resetStoreState 除了初始化会调⽤，重置 store 时以及动态注册模块时都会⽤到。</li></ol></li><li>store 分发</li><li>state 变更引发副作⽤和视图更新=&gt;reactive</li></ol><h5 id="vuex4源码dispatch-和-commit-将原型上的同名方法重写" tabindex="-1"><a class="header-anchor" href="#vuex4源码dispatch-和-commit-将原型上的同名方法重写" aria-hidden="true">#</a> vuex4源码dispatch 和 commit 将原型上的同名方法重写？</h5><p>⽬的就是保证，当解构 commit/dispatch 时，this 指向依旧为 store 实例</p><h2 id="ssr" tabindex="-1"><a class="header-anchor" href="#ssr" aria-hidden="true">#</a> SSR</h2><p>服务端渲染</p><blockquote><p>web1.0 时代，几乎所有的页面都是服务端渲染的...现在，只是又绕回去了而已</p></blockquote><h4 id="csr-vs-ssr" tabindex="-1"><a class="header-anchor" href="#csr-vs-ssr" aria-hidden="true">#</a> CSR VS SSR</h4><p>首先让我们看看 CSR 的过程（浏览器渲染原理基本流程）</p><p><img src="https://raw.githubusercontent.com/yacan8/blog/master/images/服务端渲染原理/image-20200730191954015.png" alt="csr"></p><p>过程如下：</p><ol><li>浏览器通过请求得到一个<code>HTML</code>文本</li><li>渲染进程解析<code>HTML</code>文本，构建<code>DOM</code>树</li><li>解析<code>HTML</code>的同时，如果遇到内联样式或者样式脚本，则下载并构建样式规则（<code>stytle rules</code>），若遇到<code>JavaScrip</code>t脚本，则会下载执行脚本。</li><li><code>DOM</code>树和样式规则构建完成之后，渲染进程将两者合并成渲染树（<code>render tree</code>）</li><li>渲染进程开始对渲染树进行布局，生成布局树（<code>layout tree</code>）</li><li>渲染进程对布局树进行绘制，生成绘制记录</li><li>渲染进程的对布局树进行分层，分别栅格化每一层，并得到合成帧</li><li>渲染进程将合成帧信息发送给<code>GPU</code>进程显示到页面中</li></ol><p>很容易发现，<code>CSR</code> 的特点就是会在浏览器端的运行时去动态的渲染、更新 <code>DOM</code> 节点，特别是 <code>SPA</code> 应用来说，其模版 <code>HTML</code> 只有一个 <code>DIV</code>，然后是运行时（<code>React</code>，<code>Vue</code>，<code>Svelte</code> 等）动态的往里插入内容，这样的话各种 <code>BaiduSpider</code> 拿不到啥有效信息，自然 <code>SEO</code> 就不好了，项目一旦复杂起来， <code>bundle</code> 可能超乎寻常的大...这也是一个开销</p><p>那么<code>SSR</code> 呢，则是是服务端完成了渲染过程，将渲染完成的 <code>HTML</code> 字符串或者流返回给浏览器，就少了脚本解析、运行这一环节，理论上 <code>FP</code> 表现的更佳，<code>SEO</code> 同样</p><p><img src="https://raw.githubusercontent.com/yacan8/blog/master/images/服务端渲染原理/image-20200731165404271.png" alt="csr vs ssr"></p><p>但其实，现在 <code>SSR</code> 也并没有大行其道，凡事有利有弊，<code>SSR</code> 也是有缺点的</p><ol><li>复杂，同构项目的代码复杂度直线上升，因为要兼容两种环境</li><li>对服务端的开销大，既然 <code>HTML</code> 都是拼接好的，那么传输的数据肯定就大多了，同时，拿 <code>Node</code> 举例，在处理 <code>Computed</code> 密集型逻辑的时候是阻塞的，不得不上负载均衡、缓存策略等来提升</li><li>CI/CD 更麻烦了，需要在一个 <code>Server</code> 环境，比如 <code>Node</code></li></ol><blockquote><p>一般来说，ToB 的业务场景基本不需要 SSR，需要 SSR 的一定是对首屏或者 SEO 有强诉求的，不然没必要搞那么麻烦，简洁是避免麻烦的最佳实践，同时，随着浏览器发展，越来越快，爬虫也越来越智能，SSR 的场景在被压缩</p></blockquote><p>说到了 <code>CSR</code> 和 <code>SSR</code> ，其实我们现今常见的渲染方案有6-7种吧！</p><p><img src="https://image-static.segmentfault.com/324/269/3242695953-5c7c0095b3cf5_fix732" alt="render"></p><p>注意，这里提到了 <code>hydration</code> 这个词，这是一个很棒的思路，对 <code>FP</code> 有帮助，但是不能提升 <code>TTI</code></p><blockquote><p>补充资料，务必精读</p><p><a href="https://ssr.vuejs.org/zh/#%E4%BB%80%E4%B9%88%E6%98%AF%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E6%B8%B2%E6%9F%93-ssr-%EF%BC%9F" target="_blank" rel="noopener noreferrer">VUE SSR 指南（动手操练一下最佳）<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></blockquote><h4 id="同构应用" tabindex="-1"><a class="header-anchor" href="#同构应用" aria-hidden="true">#</a> 同构应用</h4><p>我们以上面的指南为基础讲讲同构应用（因为同构应用算是比较复杂的了），通过同构应用让大家对 <code>SSR</code> 有一个更直观、立体的认识</p><p>首先需要了解什么是同构应用</p><blockquote><p>一份代码，既可以客户端渲染，也可以服务端渲染</p></blockquote><p>看看客户端渲染，对我们而言，基本可以这样概括：页面 = 模版 + 数据，应用 = 路由 + 页面</p><p>所以，同构，我们需要注意的是构了个啥？，就是 <strong>路由</strong>、<strong>模版</strong>、<strong>数据</strong></p><p><img src="https://raw.githubusercontent.com/yacan8/blog/master/images/服务端渲染原理/vue服务端渲染构建.png" alt="同构"></p><p>假定大家已经认真阅读并实际操练了 <code>VUE SSR</code> 指南，</p><p>现在就一些实践经验做一些补充：</p><ol><li><p>服务端的 <code>webpack</code> 不用关注 <code>CSS</code>，客户端会打包出来的，到时候推 <code>CDN</code>，然后改一下 <code>public path</code> 就好了</p></li><li><p>服务端的代码不需要分 <code>chunk</code>，<code>Node</code> 基于内存一次性读取反而更高效</p></li><li><p>如果有一些方法需要在特定的环境执行，比如客户端环境中上报日志，可以利用 <code>beforeMouted</code> 之后的生命周期都不会在服务端执行这一特点，当然也可以使用 <code>isBrowser</code> 这种判断</p></li><li><p><code>CSR</code> 和 <code>SSR</code> 的切换和降级</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 总有一些奇奇怪怪的场景，比如就只需要 CSR，不需要 SSR</span>
<span class="token comment">// 或者在 SSR 渲染的时候出错了，页面最好不要崩溃啊，可以降级成 CSR 渲染，保证页面能够出来</span>

<span class="token comment">// 互相切换的话，总得有个标识是吧，告诉我用 CSR 还是 SSR</span>
<span class="token comment">// search 就不错，/demo?ssr=true</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>ssr <span class="token operator">===</span> <span class="token string">&#39;true&#39;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> context <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">url</span><span class="token operator">:</span> req<span class="token punctuation">.</span>url <span class="token punctuation">}</span>
    renderer<span class="token punctuation">.</span><span class="token function">renderToString</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> html</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&#39;demo&#39;</span><span class="token punctuation">)</span> <span class="token comment">// views 文件下的 demo.html</span>
      <span class="token punctuation">}</span>
      res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&#39;demo&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div></li><li><p><code>Axios</code> 封装，至少区分环境，在客户端环境是需要做代理的</p></li></ol><blockquote><p>这里的最佳实践知识抛砖引玉，还是得自己去踩坑总结</p></blockquote><p><code>VUE-SSR</code> 优化方案：</p><ol><li>页面级别的缓存，比如 <code>nginx</code> <code>micro-caching</code></li><li>设置 <code>serverCacheKey</code>，如果相同，将使用缓存，组件级别的缓存</li><li><code>CGI</code> 缓存，通过 <code>memcache</code> 等，将相同的数据返回缓存一下，注意设置缓存更新机制</li><li>流式传输，但是必须在<code> asyncData</code> 之后，否则没有数据，说明也可能会被 <code>CGI</code> 耗时阻塞</li><li>分块传输，这样前置的 <code>CGI</code> 完成就会渲染输出，但是这个方案难啊</li><li><a href="https://juejin.cn/post/6844903476120518670" target="_blank" rel="noopener noreferrer">JSC<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，就是不用 <code>vue-loader</code></li></ol><h4 id="ssr特点" tabindex="-1"><a class="header-anchor" href="#ssr特点" aria-hidden="true">#</a> ssr特点</h4><p>优点 首屏加载快、有利于seo 缺点:server压力大，负载均衡</p><p>服务端为什么不导出一个router实例，而是工程模式函数封装 因为用户每一个请求都创建一个实例·</p><h1 id="vuex-4版本" tabindex="-1"><a class="header-anchor" href="#vuex-4版本" aria-hidden="true">#</a> vuex 4版本</h1><p>vuex 是⼀个专为 vue.js 应⽤程序开发的状态管理模式 + 库。它采⽤集中式存储管理应⽤的所有组件的状态，并以相应的规则保证状态以⼀种可预测的方式发生变化。 与 vuex 4 相匹配的版本是 vue 3。</p><p>在组件访问store inject或者$stroe</p><p>重写了dispatch和content是为了保证this指向store实例</p><p>redux是和react独立的，vuex依赖于vuex，为vue而生 单向数据流</p><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">上次更新时间: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">贡献者列表: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 768206581@qq.com">liuchenglong</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.02f2aee7.js" defer></script>
  </body>
</html>
